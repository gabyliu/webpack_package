!function(e){function t(s){if(a[s])return a[s].exports;var i=a[s]={exports:{},id:s,loaded:!1};return e[s].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}({0:function(e,t,a){e.exports=a(5)},5:function(e,t,a){"use strict";function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Inner=t.SingleFilePick=t.ImagePick=void 0;var i;a(14);var n=React.createClass({displayName:"ImagePick",getInitialState:function(){return{img:this.props.data.img,load:{show:0,progress:0},isDragover:0,isHover:0}},handleClick:function(){this.refs.imagePickInput.getDOMNode().click()},handleChange:function(e){var t=e.target.files;this.showPreview(t[0]);var a=this.checkPattern(t[0]);a.isPass?this.upload(t[0]):this.response(null,a.status)},showPreview:function(e){var t=new FileReader;t.readAsDataURL(e),t.onload=function(e){this.setState({img:t.result})}.bind(this)},handleDragOver:function(e){e.stopPropagation(),e.preventDefault(),this.setState({isDragover:1})},handleDrop:function(e){e.stopPropagation(),e.preventDefault(),this.setState({isDragover:0});var t=e.dataTransfer,a=t.files;console.log(JSON.stringify(t)),this.showPreview(a[a.length-1]);var s=this.checkPattern(a[a.length-1]);return s.isPass?(this.upload(a[a.length-1]),a[a.length-1]=!1):this.response(null,s.status),!1},checkPattern:function(e){var t=e.type,a={};return t.indexOf("image/")>=0?(t=t.replace("image/",""),this.props.data.reg.format.indexOf(t)>=0?this.props.data.reg.size?this.props.data.reg.size>=e.size?a.isPass=!0:(a.isPass=!1,a.status="oversized"):a.isPass=!0:(a.isPass=!1,a.status="format error")):(a.isPass=!1,a.status="format error"),a},handleDragLeave:function(e){this.setState({isDragover:0})},uploading:function(e,t){this.setState({load:{show:1,progress:e/t}})},response:function(e,t){this.setState({load:{show:0}});var a={index:this.props.data.responseValue,status:t,value:e};this.props.data.handle(a)},upload:function(e){!function(e,t){var a=new XMLHttpRequest;new FileReader;if(a.upload){a.upload.addEventListener("progress",function(e){t.uploading(e.loaded,e.total)},!1);var s=new FormData;for(var i in t.props.data.requestValue)s.append(i,t.props.data.requestValue[i]);s.append("file",e),s.append("name",e.name),s.append("type",e.type),s.append("lastModifiedDate",e.lastModifiedDate),s.append("size",e.size),a.open("POST","/cgi-bin/mmemoticonmgr-bin/uploadmedia",!0),a.send(s),a.onreadystatechange=function(e){4==a.readyState&&200==a.status&&t.response(JSON.parse(a.response),"suc")}}}(e,this)},handleMouseoverPick:function(e){e.stopPropagation(),e.preventDefault(),1!=this.state.isHover&&this.setState({isHover:1})},handleMouseleavePick:function(e){e.stopPropagation(),e.preventDefault(),this.setState({isHover:0})},handleClickDele:function(e){e.stopPropagation(),e.preventDefault();var t={index:this.props.data.responseValue,status:"dele",value:null};this.props.data.handle(t),this.setState({preview:null})},render:function(){var e="imagePickArea "+this.props.data.extendClass,t="+",a={width:100*this.state.load.progress+"%"},s=1==this.state.load.show?React.createElement("div",{className:"imagePickLoadArea"},React.createElement("div",{className:"loadBar"},React.createElement("div",{className:"loadContent",style:a}))):null,i=this.props.data.isNeedDele&&this.state.img&&1==this.state.isHover?React.createElement("div",{className:"imagePickDeleArea"},React.createElement("a",{href:"javascript:;",className:"btn btn_warn",onClick:this.handleClickDele},"删除")):null;return 1==this.state.isHover?e+=" hover":null,1==this.state.isDragover&&(e+=" dragover",this.props.data.text.dragover?t=this.props.data.text.dragover:null),React.createElement("div",{className:e,onMouseOver:this.handleMouseoverPick,onMouseLeave:this.handleMouseleavePick,onDragLeave:this.handleDragLeave,onClick:this.handleClick,onDragOver:this.handleDragOver,onDrop:this.handleDrop},React.createElement("div",{className:"imagePick"},React.createElement("input",{ref:"imagePickInput",onChange:this.handleChange,className:"imagePickUploader_input",type:"file"}),React.createElement("div",{className:"imagePickUploader_btn"},t),this.state.img?React.createElement("img",{className:"imagePickUploader_preview",ref:"imagePickUploader_preview",src:this.state.img}):null),i,s)}}),r=React.createClass((i={displayName:"SingleFilePick",getInitialState:function(){return console.log("SingleFilePick getInitialState"),{preview:this.props.data.preview,load:{show:0,progress:0},status:"",isDragover:0,isHover:0}},uploading:function(e,t){console.log("uploading"),this.setState({load:{show:1,progress:e/t}})},upload:function(e){console.log("upload"),function(e,t){var a=new XMLHttpRequest;new FileReader;if(a.upload){a.upload.addEventListener("progress",function(e){t.uploading(e.loaded,e.total)},!1);var s=new FormData;for(var i in t.props.data.requestValue)s.append(i,t.props.data.requestValue[i]);s.append("file",e),s.append("name",e.name),s.append("type",e.type),s.append("lastModifiedDate",e.lastModifiedDate),s.append("size",e.size),a.open("POST","/cgi-bin/mmemoticonmgr-bin/uploadmedia",!0),a.send(s),a.onreadystatechange=function(e){4==a.readyState&&200==a.status&&t.response(JSON.parse(a.response),"suc")}}}(e,this)},handleMouseoverPick:function(){console.log("handleMouseoverPick"),this.setState({isHover:1})},handleMouseleavePick:function(){console.log("handleMouseleavePick"),this.setState({isHover:0})},handleDragOver:function(e){e.stopPropagation(),e.preventDefault(),console.log("handleDragOver"),this.setState({isDragover:1})},handleDrop:function(e){e.stopPropagation(),e.preventDefault(),this.setState({isDragover:0});var t=e.dataTransfer,a=t.files;console.log(JSON.stringify(t)),this.showPreview(a[a.length-1]);var s=this.checkPattern(a[a.length-1]);return s.isPass?(this.upload(a[a.length-1]),a[a.length-1]=!1):this.response(null,s.status),!1},checkPattern:function(e){var t=(e.type,{});return e.name.substring(e.name.length-3,e.name.length)==this.props.data.setting.reg.format?this.props.data.setting.reg.size?this.props.data.setting.reg.size>e.size?t.isPass=!0:(t.isPass=!1,t.status="oversized",this.setState({status:t.status})):t.isPass=!0:(t.isPass=!1,t.status="format error",this.setState({status:t.status})),t},response:function(e,t,a){this.setState({load:{show:0}});var s={name:a,id:this.props.data.setting.id,status:t,value:e};this.props.data.handle(s)},showPreview:function(e){var t=new FileReader;t.readAsDataURL(e),t.onload=function(t){this.setState({preview:e.name})}.bind(this)}},s(i,"upload",function(e){!function(e,t){var a=new XMLHttpRequest;new FileReader;if(a.upload){a.upload.addEventListener("progress",function(e){t.uploading(e.loaded,e.total)},!1);var s=new FormData;for(var i in t.props.data.setting.request.data)s.append(i,t.props.data.setting.request.data[i]);s.append("file",e),s.append("name",e.name),s.append("type",e.type),s.append("lastModifiedDate",e.lastModifiedDate),s.append("size",e.size),a.open("POST","/cgi-bin/mmemoticonmgr-bin/uploadmedia",!0),a.send(s),a.onreadystatechange=function(s){if(4==a.readyState){if(200==a.status)switch(JSON.parse(a.response).base_resp.ret){case 0:t.setState({status:"suc"}),t.response(JSON.parse(a.response),"suc",e.name);break;default:t.setState({status:"system error"}),t.response(JSON.parse(a.response),"system error",e.name)}}else t.response("","system error",e.name)}}}(e,this)}),s(i,"handleDragLeave",function(e){e.stopPropagation(),e.preventDefault(),console.log("handleDragLeave"),this.setState({isDragover:0})}),s(i,"handleClickDele",function(e){e.stopPropagation(),e.preventDefault();var t={id:this.props.data.setting.id,status:"dele",value:null};this.props.data.handle(t),this.setState({preview:null})}),s(i,"componentWillMount",function(){console.log("single componentWillMount")}),s(i,"render",function(){var e=this.props.data.setting.classname?"filePickArea "+this.props.data.setting.classname:"filePickArea",t={width:100*this.state.load.progress+"%"},a=React.createElement("div",{className:"filePickUploader_btn"},React.createElement("div",{className:"ic"}),React.createElement("div",{className:"text"},"点击或拖拽上传")),s="";switch(this.state.status){case"format error":s="文件格式不正确";break;case"oversized":s="文件超过大小";break;case"system error":s="系统错误"}return e=this.state.isHover?e+" hover":e,a=this.state.load.show?React.createElement("div",{className:"filePickLoadArea"},React.createElement("div",{className:"loadBar"},React.createElement("div",{className:"loadContent",style:t}))):this.state.isDragover?React.createElement("div",{className:"filePickUploader_btn dragOver"},"释放鼠标"):a,React.createElement("div",{className:"fileUploaderGroup"},this.props.data.setting.label?React.createElement("label",{className:"frm_label"},this.props.data.setting.label):null,React.createElement("div",{className:e,onMouseOver:this.handleMouseoverPick,onMouseLeave:this.handleMouseleavePick,onDragLeave:this.handleDragLeave,onClick:this.handleClick,onDragOver:this.handleDragOver,onDrop:this.handleDrop},React.createElement("div",{className:"filePick"},React.createElement("input",{ref:"filePickInput",onChange:this.handleChange,className:"filePickUploader_input",type:"file"}),a),this.state.preview?React.createElement("div",{className:"previewContainer"},"suc"==this.state.status&&this.state.status?null:React.createElement("i",{className:"ic_err"}),this.state.preview,React.createElement("span",{className:"errMsg"},s),React.createElement("a",{className:"link_dele",href:"javascript:;",onClick:this.handleClickDele},"删除")):null))}),i)),l=React.createClass({displayName:"Inner",getInitialState:function(){var e;return{isOpen:{ImagePick:!1,SingleFilePick:!1},ImagePick1ImagePick:{setting:{id:"ImagePick",classname:"imagepickerClassName",label:"我是ImagePicker的label",text:{normal:"点击上传",hover:"释放鼠标"},reg:{format:"png",size:1048576},request:{url:"/cgi-bin/mmemoticonmgr-bin/uploadmedia",data:{mediaType:123,mediaType2:223,mediaType3:323}}},value:null,preview:"",handle:this.handle},ImagePick:{extendClass:"imagePickExtendClass tc",img:"https://sticker.weixin.qq.com/htdocs/zh_CN/images/index/home_item127602b.png",reg:{format:"png",size:12288},text:{dragover:"松开鼠标"},isNeedDele:!0,request:"/cgi-bin/mmemoticonmgr-bin/uploadmedia",requestValue:{mediaType:123,mediaType2:223,mediaType3:323},responseValue:{id:"ImagePick",v:"带回来啦"},handle:this.handleImageChange},SingleFilePick:{setting:(e={label:"我是SingleFilePick的label",id:"SingleFilePick",classname:"singlePickerClassName"},s(e,"label","我是单文件上传的label"),s(e,"reg",{format:"zip",size:1099511627776}),s(e,"request",{url:"/cgi-bin/mmemoticonmgr-bin/uploadmedia",data:{mediaType:123,mediaType2:223,mediaType3:323}}),e),handle:this.handleFile,value:null,preview:""},result:{ImagePick:"",SingleFilePick:""}}},handleFile:function(e){var t=this.state.result;t[e.id]=JSON.stringify(e),this.setState({result:t})},handleImageChange:function(e){var t=this.state.result;t[e.index.id]=JSON.stringify(e),this.setState({result:t})},handleClickOpenSetting:function(e,t){var a=this.state.isOpen;a[e]=!a[e],this.setState({isOpen:a})},render:function(){var e=JSON.stringify(this.state.ImagePick,null,"\t"),t=JSON.stringify(this.state.SingleFilePick,null,"\t");return React.createElement("div",{className:"inner"},React.createElement("h3",{className:this.state.isOpen.ImagePick?"title_Widget open":"title_Widget close",onClick:this.handleClickOpenSetting.bind(this,"ImagePick")},"fileUploader.ImagePick"),this.state.isOpen.ImagePick?React.createElement("pre",{className:"setting"},e):null,React.createElement(n,{data:this.state.ImagePick}),React.createElement("p",{className:"result"},"结果是：",React.createElement("br",null),this.state.result.ImagePick),React.createElement("br",null),React.createElement("br",null),React.createElement("br",null),React.createElement("h3",{className:this.state.isOpen.SingleFilePick?"title_Widget open":"title_Widget close",onClick:this.handleClickOpenSetting.bind(this,"SingleFilePick")},"fileUploader.SingleFilePick"),this.state.isOpen.SingleFilePick?React.createElement("pre",{className:"setting"},t):null,React.createElement(r,{data:this.state.SingleFilePick}),React.createElement("p",{className:"result"},"结果是：",React.createElement("br",null),this.state.result.SingleFilePick),React.createElement("br",null),React.createElement("br",null),React.createElement("br",null))}});React.render(React.createElement(l,null),document.getElementById("inner")),t.ImagePick=n,t.SingleFilePick=r,t.Inner=l},14:function(e,t){}});
//# sourceMappingURL=index.6fb9.js.map